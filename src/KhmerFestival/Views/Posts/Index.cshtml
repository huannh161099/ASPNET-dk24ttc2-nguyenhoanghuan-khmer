@model IEnumerable<KhmerFestival.Models.Post>
@{
    ViewData["Title"] = "Lễ Hội Khmer - Văn Hóa và Ẩm Thực";
    ViewData["Description"] = "Giới thiệu và khám phá các lễ hội truyền thống, văn hóa và ẩm thực đặc sắc của người Khmer Nam Bộ.";
    int page = (int)(ViewBag.Page ?? 1);
    int totalPages = (int)(ViewBag.TotalPages ?? 1);
    string q = (string)(ViewBag.Query ?? "");

    var sliderItems = Model
        .Where(p => !string.IsNullOrEmpty(p.ImageUrl))
        .OrderByDescending(p => p.PublishedAt ?? p.CreatedAt)
        .Take(15)
        .ToList();
}


<section class="bg-light position-relative text-center py-5 mb-4 border-bottom">
    <div class="container position-relative">
        <h1 class="display-5 fw-bold text-primary mb-3">Lễ Hội Của Người Khmer Nam Bộ</h1>
        <p class="lead text-muted mx-auto" style="max-width: 720px;">
            Các lễ hội của người Khmer là dịp để cộng đồng gắn kết, tưởng nhớ tổ tiên và thể hiện lòng biết ơn đối với thiên nhiên.
            Đây là nét đẹp văn hóa đặc sắc đã được lưu truyền qua nhiều thế hệ, góp phần tạo nên bản sắc văn hóa độc đáo của vùng Nam Bộ.
        </p>
    </div>
</section>


@if (sliderItems.Any())
{
    <section class="container mb-5">
        <div id="festivalCarousel" class="carousel slide shadow-sm rounded overflow-hidden" data-bs-ride="carousel">
            <div class="carousel-indicators">
                @for (int i = 0; i < sliderItems.Count; i++)
                {
                    <button type="button"
                            data-bs-target="#festivalCarousel"
                            data-bs-slide-to="@i"
                            class="@(i == 0 ? "active" : "")"
                            aria-current="@(i == 0 ? "true" : "false")"
                            aria-label="Slide @(i + 1)">
                    </button>
                }
            </div>

            <div class="carousel-inner">
                @for (int i = 0; i < sliderItems.Count; i++)
                {
                    var s = sliderItems[i];
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <a asp-controller="Posts" asp-action="Details" asp-route-slug="@s.Slug" class="d-block">
                            <img src="@s.ImageUrl"
                                 class="d-block w-100"
                                 alt="@s.Title"
                                 style="height:420px;object-fit:cover;" loading="lazy" />
                        </a>
                        <div class="carousel-caption d-none d-md-block text-start bg-dark bg-opacity-50 rounded p-3">
                            <h5 class="mb-1">@s.Title</h5>
                            @if (!string.IsNullOrWhiteSpace(s.Summary))
                            {
                                <p class="mb-2 small">@s.Summary</p>
                            }
                            <a asp-controller="Posts" asp-action="Details" asp-route-slug="@s.Slug" class="btn btn-sm btn-primary">
                                Xem chi tiết
                            </a>
                        </div>
                    </div>
                }
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#festivalCarousel" data-bs-slide="prev" aria-label="Trước">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#festivalCarousel" data-bs-slide="next" aria-label="Sau">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
        </div>
    </section>
}


<div class="container pb-5">

    
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <h2 class="h4 fw-semibold mb-0 text-secondary">Khám phá các lễ hội tiêu biểu</h2>

        <form method="get" class="d-flex" style="max-width:360px;">
            <div class="input-group">
                <input class="form-control" name="q" value="@q" placeholder="Tìm lễ hội, văn hóa, ẩm thực..."
                       aria-label="Tìm kiếm lễ hội" />
                <button class="btn btn-primary" type="submit" aria-label="Tìm kiếm">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </form>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Không tìm thấy lễ hội phù hợp</h4>
            @if (!string.IsNullOrEmpty(q))
            {
                <p class="text-muted">Hãy thử tìm với từ khóa khác.</p>
            }
        </div>
    }
    else
    {
        
        <div class="row g-4">
            @foreach (var p in Model)
            {
                <div class="col-12 col-md-6 col-lg-4">
                    <article class="card border-0 shadow-sm h-100 hover-shadow transition-all">
                        <div class="position-relative">
                            <a asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug" class="text-decoration-none">
                                <img src="@p.ImageUrl" alt="@p.Title" class="card-img-top" style="height:220px;object-fit:cover;" loading="lazy" />
                            </a>
                            <div class="position-absolute bottom-0 start-0 w-100 px-3 py-2" style="background: rgba(0,0,0,0.4);">
                                <small class="text-white">
                                    <i class="far fa-calendar-alt me-1"></i>
                                    @(p.PublishedAt?.ToLocalTime().ToString("dd/MM/yyyy") ?? "Chưa xuất bản")
                                </small>
                            </div>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h3 class="h5 fw-semibold mb-2">
                                <a asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug" class="text-decoration-none text-dark">
                                    @p.Title
                                </a>
                            </h3>
                            <p class="text-muted flex-grow-1">@p.Summary</p>
                            <div class="mt-2">
                                <a asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug" class="btn btn-sm btn-outline-primary">
                                    <i class="fa-solid fa-book-open me-1"></i> Xem chi tiết
                                </a>
                            </div>
                        </div>
                    </article>
                </div>
            }
        </div>

        
        @if (totalPages > 1)
        {
            <nav class="mt-5" aria-label="Phân trang lễ hội">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(page == 1 ? "disabled" : "")">
                        <a class="page-link" asp-route-page="@(page - 1)" asp-route-q="@q" aria-label="Trang trước">
                            &laquo;
                        </a>
                    </li>

                    @{
                        int startPage = Math.Max(1, page - 2);
                        int endPage = Math.Min(totalPages, page + 2);
                    }

                    @if (startPage > 1)
                    {
                        <li class="page-item">
                            <a class="page-link" asp-route-page="1" asp-route-q="@q">1</a>
                        </li>
                        @if (startPage > 2)
                        {
                            <li class="page-item disabled"><span class="page-link">...</span></li>
                        }
                    }

                    @for (int i = startPage; i <= endPage; i++)
                    {
                        <li class="page-item @(i == page ? "active" : "")">
                            <a class="page-link" asp-route-page="@i" asp-route-q="@q">@i</a>
                        </li>
                    }

                    @if (endPage < totalPages)
                    {
                        @if (endPage < totalPages - 1)
                        {
                            <li class="page-item disabled"><span class="page-link">...</span></li>
                        }
                        <li class="page-item">
                            <a class="page-link" asp-route-page="@totalPages" asp-route-q="@q">@totalPages</a>
                        </li>
                    }

                    <li class="page-item @(page == totalPages ? "disabled" : "")">
                        <a class="page-link" asp-route-page="@(page + 1)" asp-route-q="@q" aria-label="Trang sau">
                            &raquo;
                        </a>
                    </li>
                </ul>
            </nav>
        }
    }
</div>

<style>
    .hover-shadow {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        .hover-shadow:hover {
            transform: translateY(-4px);
            box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.15) !important;
        }

    .breadcrumb a {
        text-decoration: none;
    }

        .breadcrumb a:hover {
            text-decoration: underline;
        }
</style>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
}
